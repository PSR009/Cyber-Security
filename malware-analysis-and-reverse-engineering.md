# Malware Analysis and Reverse Engineering

## Tools

|Tool|Description|
|:-:|:-:|
|ProcDOT|Visualize system activities for behavioral analysis of malware|

### ProcDOT

- Preqrequistes
  - [WinDump](https://www.winpcap.org/windump/install/default.htm)
  - [Npcap](https://npcap.com/)
  - [Graphviz](https://graphviz.org/download/)
  - [ProcMon](https://learn.microsoft.com/en-us/sysinternals/downloads/procmon)
    - Configuration to save as `CSV`
      - Uncheck `Enable Advanced Output` under `Filter` menu
      - Uncheck `Show Resolved Network Addresses` under `Options` menu
      - Under `Options` &rarr; `Select Columns`
        - Uncheck `Sequence Number` and check `Thread ID`

## Assembly Language

- [Malware analysis - part 1: My intro to x86 assembly.](https://cocomelonc.github.io/tutorial/2021/10/03/malware-analysis-1.html) by cocomelonc
- [Assembly Language / Reversing / Malware Analysis -resources](https://gist.github.com/kimusan/475bf632009fc8eef9f22a6489b74a03) by Kim Schulz

## Evasion Techniques

- [MALWARE DETECTION : EVASION TECHNIQUES](https://www.cyfirma.com/research/malware-detection-evasion-techniques/) by Cyfirma
  - Signature-based Evasion Techniques
    - Polymorphic and Metamorphic Malware
    - File Encryption
    - Packers and Crypters
    - Code Obfuscation
  - Behaviour-based Evasion Techniques
    - Sandbox Detection
    - Environment Checking
    - Process Hollowing
  - Anti-analysis Techniques
    - Code Obfuscation
    - Anti-debugging Techniques
    - Anti-VM Detection
  - Process Injection Techniques
    - DLL Injection
    - Code Injection
    - Thread Injection
    - Memory Allocation/Write Techniques
  - Fileless Malware Techniques
    - Memory-based Execution
    - Living-off-the-land Techniques (LOLbins)
    - Registry-based Attacks
- [Five Anti-Analysis Tricks That Sometimes Fool Analysts](https://www.malwarebytes.com/blog/news/2014/09/five-anti-debugging-tricks-that-sometimes-fool-analysts) by Malwarebytes
  - VMware I/O port
  - Virtual PC instructions
  - Check Descriptor Table Registers
  - DLLScanning
  - Product ID check
- [Common Anti-Debugging Techniques in the Malware Landscape](https://www.deepinstinct.com/blog/common-anti-debugging-techniques-in-the-malware-landscape) by  Deep Instinct
  - PEB Structure
    - BeingDebugged (isDebuggerPresent, CheckRemoteDebuggerPresent, NtQueryInformationProcess)
    - ProcessHeap
  - Residue in the system - Registry keys, FindWindow
  - Identifying Breakpoints - Instructions scanning, Calculate code checksum or hash
  - The Debuggerâ€™s Environment - OutputDebugString, Timing checks, Debugger vulnerabilities
  - Image File Execution Options (IFEO) - `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\<particular_program>`
  - TLS Callback
- [Malware Anti-VM Techniques](https://www.cynet.com/attack-techniques-hands-on/malware-anti-vm-techniques/) by Cynet
- [Malware Anti-Analysis Techniques and Ways to Bypass Them](https://www.infosecinstitute.com/resources/malware-analysis/malware-anti-analysis-techniques-ways-bypass/) by Infosec Institute

## Process Injection

- [Ten process injection techniques: A technical survey of common and trending process injection techniques](https://www.elastic.co/blog/ten-process-injection-techniques-technical-survey-common-and-trending-process) by Elastic
  - DLL Injection (via CreateRemoteThread AND LoadLibrary)
  - PE Injection
  - Process Hollowing
  - Thread Execution Hijacking
  - Hook Injection via SetWindowsHookEx
  - Injection and Persistence via Registry Modification (AppInit_DLLs, AppCertDlls, Image File Execution Options (IFEO))
  - APC Injection and AtomBombing
  - Extra Window Memoery Injection (EWMI) Via SetWindowLong
  - Injection using Shims
  - IAT Hooking and Inline Hooking (a.k.a Userland Rootkits)
- [Process Injection Techniques](https://www.cynet.com/attack-techniques-hands-on/process-injection-techniques/) by Cynet

### Samples

|MD5|Reference|
|:-:|:-:|
|bcd1e2dc3740bf5eb616e8249d1e2d9c|  [Infostealer Prynt Malware a Deep Dive into Its Process Injection Technique](https://www.cyfirma.com/research/infostealer-prynt-malware-a-deep-dive-into-its-process-injection-technique/)|
|9724934a3ed3a92b38b89fe7a2e9b6fd|  [Reverse Engineering Quick Tip - Unpacking Process Injection With a Single Breakpoint](https://youtu.be/Min6DWTHDBw?si=K1TmqzujVgi7o6_t)|
|6d176c6c7d58d921b773f83b1846750d|  [A Deep Dive Into IcedID Malware: Part I - Unpacking, Hooking and Process Injection](https://www.fortinet.com/blog/threat-research/icedid-malware-analysis-part-one)|
|8938334524ba216d5fbc017475561ccf|  [Malware Analysis - Code Injection via CreateRemoteThread & WriteProcessMemory](https://youtu.be/W_rAxPm4TTU?si=oQYWTq_a-gaTQDii)|
|6e5654da58c03df6808466f0197207ed|  [Malware Analysis - Process Hollowing](https://youtu.be/aBKk2KAN0E0?si=FJqRC2VQ0GiCWKDU)|

## Practical Malware Analysis

- [Practical Malware Analysis Tutorials](https://www.youtube.com/playlist?list=PLt9cUwGw6CYEpBwasTz7WWgphfRWof0_O)
- [Sam Bowne - Practical Malware Analysis](https://youtube.com/playlist?list=PL7gCgFw1RV1PgrZftw3kd23cLjobGEStR&si=oXnB3w6WNp0rPMRj)
